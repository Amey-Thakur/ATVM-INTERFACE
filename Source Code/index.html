<!DOCTYPE html>
<html lang="en" ng-app="atvmApp">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MUMBAI RAILWAY | ATVM</title>
    <link rel="icon" type="image/png" href="images/mumbai_modern_monogram_logo.png">

    <!-- Premium Assets -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Core Styles -->
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/modules/themes.css" rel="stylesheet">
    <link href="css/modules/components.css" rel="stylesheet">
    <link href="css/modules/layout.css" rel="stylesheet">
    <link href="css/modules/map.css?v=9999" rel="stylesheet">
    <link href="css/atvm.css?v=99" rel="stylesheet">
    <style>
        html,
        body {
            overflow: hidden !important;
            width: 100% !important;
            height: 100% !important;
            position: fixed !important;
            inset: 0 !important;
        }
    </style>
</head>

<body ng-controller="atvmController">
    <!-- Premium Loading Screen -->
    <div class="premium-loader">
        <img src="images/mumbai_modern_monogram_logo.png"
            style="width: 80px; filter: drop-shadow(0 4px 10px rgba(0,0,0,0.1)); opacity: 1;">
        <div class="loader-bar">
            <div class="loader-fill"></div>
        </div>
        <p style="font-size: 11px; text-transform: uppercase; letter-spacing: 2px; color: #8e8e93;">Initializing Mumbai
            Rail Network...</p>
    </div>

    <!-- Script to trigger load finish -->
    <script>
        window.addEventListener('load', function () {
            setTimeout(function () {
                document.body.classList.add('loaded');
            }, 1500);
        });
    </script>

    <div class="main-container">
        <!-- Interactive Map Overlay -->
        <div class="map-overlay" ng-class="{active: showMap}">
            <div class="map-header">
                <div class="map-title">
                    <i class="fas fa-map-marked-alt"></i> Mumbai Suburban Network
                </div>
                <div class="close-map-btn" ng-click="toggleMap(false)">CLOSE MAP ✕</div>
            </div>
            <!-- Schematic Map Container -->
            <div class="map-diagram">

                <!-- Western Railway -->
                <div class="rail-line-col line-wr">
                    <div class="rail-line-label">Western</div>
                    <div class="track-line"></div>
                    <div class="map-station-node" ng-repeat="s in railwayData['Western Railway']"
                        ng-click="selectFromMap('Western Railway', s)"
                        ng-class="{'interchange': ['Dadar','Mumbai Central','Andheri','Borivali'].includes(s.name)}">
                        <div class="map-station-name">{{s.name}}</div>
                    </div>
                </div>

                <!-- Central Railway -->
                <div class="rail-line-col line-cr">
                    <div class="rail-line-label">Central</div>
                    <div class="track-line"></div>
                    <div class="map-station-node" ng-repeat="s in railwayData['Central Railway']"
                        ng-click="selectFromMap('Central Railway', s)"
                        ng-class="{'interchange': ['Dadar','Kurla','Thane','Mumbai CSMT','Kalyan'].includes(s.name)}">
                        <div class="map-station-name">{{s.name}}</div>
                    </div>
                </div>

                <!-- Harbour Line -->
                <div class="rail-line-col line-hr">
                    <div class="rail-line-label">Harbour</div>
                    <div class="track-line"></div>
                    <div class="map-station-node" ng-repeat="s in railwayData['Harbour Line']"
                        ng-click="selectFromMap('Harbour Line', s)"
                        ng-class="{'interchange': ['Kurla','Vadala Road','Panvel','Mumbai CSMT'].includes(s.name)}">
                        <div class="map-station-name">{{s.name}}</div>
                    </div>
                </div>

                <!-- Trans-Harbour Line -->
                <div class="rail-line-col line-th">
                    <div class="rail-line-label">Trans-Harbour</div>
                    <div class="track-line"></div>
                    <div class="map-station-node" ng-repeat="s in railwayData['Trans-Harbour Line']"
                        ng-click="selectFromMap('Trans-Harbour Line', s)"
                        ng-class="{'interchange': ['Thane','Vashi','Panvel','Nerul'].includes(s.name)}">
                        <div class="map-station-name">{{s.name}}</div>
                    </div>
                </div>

            </div>
            <!-- Map Footer -->
            <div class="attribution map-attribution">
                <div class="copyright-text" style="color: rgba(255,255,255,0.6);">2022 &copy; All Rights Reserved</div>
                <span class="footer-pipe" style="color: rgba(255,255,255,0.4);">|</span>
                <div class="dev-route">
                    <span class="dev-label" style="color: rgba(255,255,255,0.6);">DESIGNED & DEVELOPED BY</span>
                    <a href="https://github.com/Amey-Thakur" target="_blank" class="station-link amey-link">
                        <div class="dev-station">
                            <div class="station-dot wr-dot"></div>
                            <span class="station-name" style="color: #fff;">Amey Thakur</span>
                        </div>
                    </a>
                    <div class="route-line-connector">
                        <div class="line-segment" style="background: rgba(255,255,255,0.3);"></div>
                        <i class="fas fa-train" style="font-size: 10px; color: #fff;"></i>
                        <div class="line-segment" style="background: rgba(255,255,255,0.3);"></div>
                    </div>
                    <a href="https://github.com/msatmod" target="_blank" class="station-link mega-link">
                        <div class="dev-station">
                            <div class="station-dot cr-dot"></div>
                            <span class="station-name" style="color: #fff;">Mega Satish</span>
                        </div>
                    </a>
                </div>
            </div>
        </div>

        <div class="main-panel">
            <!-- Sidebar: Station Navigator -->
            <div class="side-panel">
                <div class="side-header" style="text-align: center; padding: 15px 0 5px 0;">
                    <h3 style="margin-bottom: 5px; line-height: 1.4;">
                        MUMBAI SUBURBAN RAILWAY<br>
                        <span style="font-size: 0.85em; opacity: 0.9;">मुंबई उपनगरीय रेल्वे</span>
                    </h3>
                    <p style="font-size: 11px; color: #888; font-weight: 600; letter-spacing: 0.5px; margin: 0;">
                        SELECT YOUR ROUTE / तुमचा मार्ग निवडा
                    </p>
                </div>

                <div class="line-selector">
                    <div class="line-card wr" ng-class="{active: currentLine == 'Western Railway'}"
                        ng-click="setLine('Western Railway')">
                        <div class="line-info">
                            <span class="line-name">WESTERN / पश्चिम</span>
                            <span class="line-route">Churchgate ⇄ Dahanu</span>
                        </div>
                    </div>
                    <div class="line-card cr" ng-class="{active: currentLine == 'Central Railway'}"
                        ng-click="setLine('Central Railway')">
                        <div class="line-info">
                            <span class="line-name">CENTRAL / मध्य</span>
                            <span class="line-route">CSMT ⇄ Kasara/Khopoli</span>
                        </div>
                    </div>
                    <div class="line-card hb" ng-class="{active: currentLine == 'Harbour Line'}"
                        ng-click="setLine('Harbour Line')">
                        <div class="line-info">
                            <span class="line-name">HARBOUR / हार्बर</span>
                            <span class="line-route">CSMT ⇄ Panvel/Goregaon</span>
                        </div>
                    </div>
                    <div class="line-card th" ng-class="{active: currentLine == 'Trans-Harbour Line'}"
                        ng-click="setLine('Trans-Harbour Line')">
                        <div class="line-info">
                            <span class="line-name" style="font-size: 14px;">TRANS-HARBOUR / ट्रान्स-हार्बर</span>
                            <span class="line-route">Thane ⇄ Vashi/Panvel</span>
                        </div>
                    </div>
                </div>

                <!-- Mode Selector (Relocated for Accessibility) -->
                <div class="mode-selector" ng-class="{'mode-dest': selectionMode == 'destination'}">
                    <div class="glider"></div>
                    <div class="mode-btn" ng-class="{active: selectionMode == 'source'}"
                        ng-click="setSelectionMode('source')">SOURCE / उगम</div>
                    <div class="mode-btn" ng-class="{active: selectionMode == 'destination'}"
                        ng-click="setSelectionMode('destination')">DESTINATION / गंतव्य</div>
                </div>

                <div class="search-container">
                    <input type="text" class="search-input" placeholder="Search Station / स्थानक शोधा..."
                        ng-model="searchText" ng-keydown="$event.keyCode === 13 && selectFirstResult()">
                    <i class="fas fa-search search-icon"></i>
                </div>

                <div class="station-list">
                    <div class="station-item" ng-repeat="station in getFilteredStations()"
                        ng-class="{active: (selectionMode == 'source' && sourceStation == station) || (selectionMode == 'destination' && destinationStation == station)}"
                        ng-click="selectStation(station)">
                        <div class="station-sign">
                            <div class="diamond"></div>
                            <div class="circle"></div>
                            <div class="bar">{{station.name}}</div>
                        </div>
                        <div class="names">
                            <span class="en">{{station.name}}</span>
                            <span class="hi">{{station.devng}}</span>
                        </div>
                        <i class="fas fa-chevron-right" style="opacity: 0.2; font-size: 12px; margin-left: auto;"></i>
                    </div>
                </div>
            </div>

            <!-- Main Dashboard -->
            <div class="main-interface">
                <!-- Floating LED Map Sign (Restored to Left) -->
                <div class="floating-map-btn" ng-click="toggleMap(true)" title="View System Map">
                    <div class="hanger-rods">
                        <div class="rod left"></div>
                        <div class="rod right"></div>
                    </div>
                    <div class="led-board">
                        <div class="led-screen">
                            <div class="led-text">VIEW MAP &nbsp;&nbsp;●&nbsp;&nbsp; नकाशा पहा &nbsp;&nbsp;●&nbsp;&nbsp;
                                DEVELOPED BY AMEY & MEGA &nbsp;&nbsp;●&nbsp;&nbsp; अमेय आणि मेगा</div>
                        </div>
                    </div>
                </div>

                <!-- Iconic Mumbai Analog Station Clock (Hanging Right) -->
                <div class="station-clock" title="Click for Announcement" ng-click="playAnnouncement()">
                    <div class="hanger-rod"></div>
                    <div class="clock-face">
                        <div class="hand hour-hand" ng-style="{'transform': 'rotate(' + hourRotation + 'deg)'}"></div>
                        <div class="hand min-hand" ng-style="{'transform': 'rotate(' + minRotation + 'deg)'}"></div>
                        <div class="hand sec-hand" ng-style="{'transform': 'rotate(' + secRotation + 'deg)'}"></div>
                        <div class="center-nut"></div>
                        <!-- Clock Numbers 1-12 -->
                        <div class="number num12">12</div>
                        <div class="number num3">3</div>
                        <div class="number num6">6</div>
                        <div class="number num9">9</div>
                    </div>
                </div>

                <!-- Mumbai Station Speaker (Beside Clock) -->
                <div class="station-speaker" title="Click for Announcement" ng-click="playAnnouncement()"
                    ng-class="{'speaking': isAnnouncing}">
                    <div class="speaker-wire"></div>
                    <div class="speaker-body">
                        <div class="speaker-grill"></div>
                        <div class="sound-waves">
                            <span></span><span></span><span></span>
                        </div>
                    </div>
                </div>

                <div class="ticket-canvas">
                    <div class="ticket" id="ticket-card" ng-class="{'train-reverse': trainDirection === 'reverse'}">
                        <!-- Interactive Train Track (Click Train to Reverse) -->
                        <div class="train-track-container">
                            <div class="train-vessel" ng-click="toggleTrainDirection($event)" style="cursor: pointer;">
                                <div class="compartment">
                                    <div class="engine-face"></div>
                                </div>
                                <div class="compartment"></div>
                                <div class="compartment"></div>
                                <div class="compartment"></div>
                            </div>
                        </div>
                        <div class="ticket-header">
                            <img src="images/mumbai_modern_monogram_logo.png" class="ticket-logo">
                            <div class="railway-label">
                                <h3>{{currentLine}} <span
                                        style="font-size: 0.8em; font-weight: 400; opacity: 0.8;">{{getLineMr(currentLine)}}</span>
                                </h3>
                                <p>Unreserved Ticketing System / अनारक्षित तिकीट प्रणाली</p>
                            </div>
                        </div>

                        <div class="ticket-body">

                            <!-- Row for Selectors (Side by Side) -->
                            <div class="controls-row">
                                <div class="journey-type-control" ng-class="{'mode-return': journeyType === 'Return'}">
                                    <div class="glider"></div>
                                    <div class="segment-option" ng-class="{active: journeyType === 'Single'}"
                                        ng-click="setJourneyType('Single')">
                                        <div class="seg-label">SINGLE <span class="mr-label">एक-मार्गी</span></div>
                                        <div class="seg-sub">Single Journey</div>
                                    </div>
                                    <div class="segment-option" ng-class="{active: journeyType === 'Return'}"
                                        ng-click="setJourneyType('Return')">
                                        <div class="seg-label">RETURN <span class="mr-label">परतीचे</span></div>
                                        <div class="seg-sub">Valid for 24 hours</div>
                                    </div>
                                </div>

                                <div class="class-selector-control" ng-class="{'class-first': ticketClass === 'First'}">
                                    <div class="class-glider"></div>
                                    <div class="class-option" ng-class="{active: ticketClass === 'Second'}"
                                        ng-click="setTicketClass('Second')">
                                        <div class="class-label">SECOND <span class="mr-label">द्वितिय</span></div>
                                        <div class="class-sub">Ordinary</div>
                                    </div>
                                    <div class="class-option" ng-class="{active: ticketClass === 'First'}"
                                        ng-click="setTicketClass('First')">
                                        <div class="class-label">FIRST <span class="mr-label">प्रथम</span></div>
                                        <div class="class-sub">Comfort</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Route Visuals (Restored Station Signs) -->
                            <div class="route-visual-row">
                                <div class="route-point">
                                    <div class="label"
                                        style="font-size: 10px; color: #888; font-weight: 700; text-transform: uppercase; margin-bottom: 5px;">
                                        Source / उगम</div>
                                    <div class="station-sign">
                                        <div class="diamond"></div>
                                        <div class="circle"></div>
                                        <div class="bar">{{sourceStation.name}}</div>
                                    </div>
                                </div>

                                <div class="route-arrow">
                                    <div class="journey-badge" style="font-size: 10px; margin-bottom: 5px;">
                                        {{journeyType
                                        === 'Return' ? 'RETURN' : 'SINGLE'}}</div>
                                    <i class="fas fa-arrow-right" style="color: #ccc; font-size: 16px;"></i>
                                    <div class="class-badge" ng-class="{'badge-first': ticketClass === 'First'}"
                                        style="margin-top: 5px;">{{ticketClass.toUpperCase()}}</div>
                                </div>

                                <div class="route-point">
                                    <div class="label"
                                        style="font-size: 10px; color: #888; font-weight: 700; text-transform: uppercase; margin-bottom: 5px;">
                                        Destination / गंतव्य</div>
                                    <div class="station-sign">
                                        <div class="diamond"></div>
                                        <div class="circle"></div>
                                        <div class="bar">{{destinationStation.name}}</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Passenger Controls -->
                            <div class="passenger-controls-grid">
                                <div class="pax-control-card">
                                    <div class="pax-label">ADULT / प्रौढ</div>
                                    <div class="stepper">
                                        <button class="step-btn minus" ng-click="updatePassenger('adults', -1)"
                                            ng-disabled="adults <= 0 || (adults == 1 && children == 0)"><i
                                                class="fas fa-minus"></i></button>
                                        <span class="step-val">{{adults}}</span>
                                        <button class="step-btn plus" ng-click="updatePassenger('adults', 1)"
                                            ng-disabled="adults == 5"><i class="fas fa-plus"></i></button>
                                    </div>
                                </div>
                                <div class="pax-control-card">
                                    <div class="pax-label">CHILD / मुले</div>
                                    <div class="stepper">
                                        <button class="step-btn minus" ng-click="updatePassenger('children', -1)"
                                            ng-disabled="children <= 0"><i class="fas fa-minus"></i></button>
                                        <span class="step-val">{{children}}</span>
                                        <button class="step-btn plus" ng-click="updatePassenger('children', 1)"
                                            ng-disabled="children == 5"><i class="fas fa-plus"></i></button>
                                    </div>
                                </div>
                            </div>

                        </div> <!-- End of .ticket-body -->

                        <!-- Footer with Fare and Print Button -->
                        <div class="ticket-controls">
                            <div class="ticket-footer">
                                <div class="fare-display">
                                    <div class="fare-label">Total Fare / एकूण भाडे</div>
                                    <div class="fare-amount">Rs. {{calculateFare()}} / ₹ {{calculateFare()}}</div>
                                </div>
                                <button class="print-btn" ng-click="exportTicket()">
                                    <i class="fas fa-print"></i> PRINT TICKET / तिकीट छापा
                                </button>
                            </div>
                        </div>

                    </div> <!-- End of .ticket -->
                </div> <!-- End of .ticket-canvas -->

                <!-- Ticket Preview Modal -->
                <div class="ticket-modal-overlay" ng-class="{active: showTicketModal}">
                    <div class="modal-backdrop" ng-click="closeModal()"></div>
                    <div class="ticket-modal-content">
                        <div class="modal-header">
                            <h3>TICKET PREVIEW / तिकीट झलक</h3>
                            <button class="close-modal-btn" ng-click="closeModal()">✕</button>
                        </div>

                        <!-- The Ticket Element for Capture -->
                        <div id="shareable-ticket-template" class="share-ticket-wrapper"> <!-- IDs kept for capture -->
                            <div class="share-ticket">
                                <div class="st-header">
                                    <img src="images/mumbai_modern_monogram_logo.png" class="st-logo">
                                    <div class="st-rail-info">
                                        <h2>INDIAN RAILWAYS / भारतीय रेल</h2>
                                        <p>CENTRAL RAILWAY / मध्य रेल</p>
                                    </div>
                                    <div class="st-type-badge">UTS</div>
                                </div>

                                <div class="st-main">
                                    <div class="st-route">
                                        <div class="st-point">
                                            <span class="st-label">SOURCE</span>
                                            <span class="st-val">{{sourceStation.name}}</span>
                                        </div>
                                        <div class="st-arrow">➔</div>
                                        <div class="st-point">
                                            <span class="st-label">DESTINATION</span>
                                            <span class="st-val">{{destinationStation.name}}</span>
                                        </div>
                                    </div>

                                    <div class="st-details-grid">
                                        <div class="st-item">
                                            <span class="st-label">JOURNEY TYPE</span>
                                            <span class="st-val">{{journeyType}}</span>
                                        </div>
                                        <div class="st-item">
                                            <span class="st-label">CLASS</span>
                                            <span class="st-val">{{ticketClass.toUpperCase()}} ({{ticketClass == 'First'
                                                ? 'I' : 'II'}})</span>
                                        </div>
                                        <div class="st-item">
                                            <span class="st-label">ADULT</span>
                                            <span class="st-val">{{adults}}</span>
                                        </div>
                                        <div class="st-item">
                                            <span class="st-label">CHILD</span>
                                            <span class="st-val">{{children}}</span>
                                        </div>
                                    </div>

                                    <div class="st-fare-sec">
                                        <span class="st-label">TOTAL FARE</span>
                                        <span class="st-price">₹ {{calculateFare()}}.00</span>
                                    </div>
                                </div>

                                <div class="st-meta">
                                    <div class="st-meta-item">
                                        <span class="st-label">TICKET ID</span>
                                        <span class="st-val">#{{ticketId}}</span>
                                    </div>
                                    <div class="st-meta-item">
                                        <span class="st-label">DATE / TIME</span>
                                        <span class="st-val">{{timestamp}}</span>
                                    </div>
                                </div>

                                <div class="st-footer">
                                    <div class="st-footer-info">
                                        <div class="st-message">"Wishing you a safe and pleasant journey on Mumbai
                                            Lifeline!"</div>
                                        <div class="st-authorship">
                                            <span class="st-dev-label">DESIGNED & DEVELOPED BY</span>
                                            <div class="author-links">
                                                <a href="https://github.com/Amey-Thakur" target="_blank"
                                                    class="author-link"><i class="fas fa-terminal"></i> AMEY THAKUR</a>
                                                <a href="https://github.com/msatmod" target="_blank"
                                                    class="author-link"><i class="fas fa-code"></i> MEGA SATISH</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="st-qr-code">
                                        <img src="https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=https://github.com/Amey-Thakur/ATVM-INTERFACE"
                                            class="qr-img" alt="QR Code" crossorigin="anonymous">
                                        <p>SECURE UTS</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="modal-actions">
                            <button class="action-btn download-btn" ng-click="downloadTicket()">
                                <i class="fas fa-download"></i>
                                <span>DOWNLOAD</span>
                            </button>
                            <button class="action-btn share-btn" ng-click="shareTicket()">
                                <i class="fas fa-share-alt"></i>
                                <span>SHARE</span>
                            </button>
                            <button class="action-btn copy-btn" ng-click="copyTicketText()">
                                <i class="fas fa-link"></i>
                                <span>COPY</span>
                            </button>
                        </div>

                    </div>
                </div>
            </div>
            <!-- Duplicate Button Removed -->
            <!-- Creative Footer (Moved to Root for Full Width) -->
            <div class="attribution">
                <div class="copyright-text">2022 &copy; All Rights Reserved</div>
                <span class="footer-pipe">|</span>
                <div class="dev-route">
                    <span class="dev-label">DESIGNED & DEVELOPED BY</span>

                    <a href="https://github.com/Amey-Thakur" target="_blank" class="station-link amey-link">
                        <div class="dev-station">
                            <div class="station-dot wr-dot"></div>
                            <span class="station-name">Amey Thakur</span>
                        </div>
                    </a>

                    <div class="route-line-connector">
                        <div class="line-segment"></div>
                        <i class="fas fa-train" style="font-size: 10px; color: #555;"></i>
                        <div class="line-segment"></div>
                    </div>

                    <a href="https://github.com/msatmod" target="_blank" class="station-link mega-link">
                        <div class="dev-station">
                            <div class="station-dot cr-dot"></div>
                            <span class="station-name">Mega Satish</span>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Creative Footer (Moved to Root for Full Width) -->

    <!-- Core Scripts -->
    <script src="js/jquery-1.11.0.min.js"></script>
    <script src="js/angular.min.js"></script>
    <script src="js/atvm-controller.js?v=6.1"></script>

    <!-- Ticket Export Library (Loaded after core) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        (function () {
            function killScroll() {
                window.scrollTo(0, 0);
                document.body.style.overflow = 'hidden';
                document.documentElement.style.overflow = 'hidden';
            }
            setInterval(killScroll, 100);
            window.addEventListener('scroll', killScroll);
        })();
    </script>
</body>

</html>